# **Лекция №2: Компоненты современной СУБД**
> _Разработка проекта_

## **Задание:**
Добавляем в модель данных дополнительные индексы и ограничения

Цель:
Применять индексы в реальном проекте.

Описание/Пошаговая инструкция выполнения домашнего задания:
Проводим анализ возможных запросов\отчетов\поиска данных.
Предполагаем возможную кардинальность поля.
Создаем дополнительные индексы - простые или композитные.
На каждый индекс пишем краткое описание зачем он нужен (почему по этому полю\полям).
Думаем какие логические ограничения в БД нужно добавить - например какие поля должны быть уникальны, в какие нужно добавить условия, чтобы не нарушить бизнес логику. Пример - нельзя провести операцию по переводу средств на отрицательную сумму.
Создаем ограничения по выбранным полям.

Критерии оценки:
Выполнение ДЗ: 10 баллов
плюс 2 балла за красивое решение
минус 2 балла за рабочее решение, и недостатки указанные преподавателем не устранены

---

## **Выполнено:**

### 1. Анализ таблицы `Продукты` (products)
Возможные запросы/ограничения:

| Поле              | Описание запроса               | Кардинальность | Ограничения                       |
|-------------------|--------------------------------|----------------|-----------------------------------|
| `id`              | Поиск по id продукта           | Высокая        | PRIMARY KEY (UNIQUE NOT NULL)     |
| `name`            | Поиск по наименованию продукта | Высокая        | Максимум 255 символов, `NOT NULL` |
| `category_id`     | Поиск товара по категории      | Средняя        | INT, `NOT NULL`                   |
| `supplier_id`     | Поиск товара по постащику      | Высокая        | INT, `NOT NULL`                   |
| `manufacturer_id` | Поиск товара по производителю  | Высокая        | INT, `NOT NULL`                   |

Индексы:
- CREATE INDEX idx_name ON products(name);
- CREATE INDEX idx_category_id_name ON products(category_id,name);
- CREATE INDEX idx_supplier_id_name ON products(supplier_id,name);
- CREATE INDEX idx_manufacturer_id_name ON products(manufacturer_id,name);
- CREATE INDEX idx_supplier_id_manufacturer_id_category_id ON products(supplier_id,manufacturer_id,category_id);
- CREATE INDEX idx_supplier_id_manufacturer_id_name ON products(supplier_id,manufacturer_id,name);
- CREATE INDEX idx_supplier_id_category_id_name ON products(supplier_id,category_id,name);


### 2. Анализ таблицы `Категории продуктов` (categories)
Возможные запросы/ограничения:

| Поле   | Описание запроса                          | Кардинальность | Ограничения                       |
|--------|-------------------------------------------|----------------|-----------------------------------|
| `id`   | Поиск по id категории продуктов           | Средняя        | PRIMARY KEY (UNIQUE NOT NULL)     |
| `name` | Поиск по наименованию категории продуктов | Средняя        | Максимум 255 символов, `NOT NULL` |

Индексы:
- CREATE INDEX idx_name ON categories(name);

### 3. Анализ таблицы `Цены` (prices)
Возможные запросы/ограничения:

| Поле         | Описание запроса                                | Кардинальность | Ограничения                   |
|--------------|-------------------------------------------------|----------------|-------------------------------|
| `id`         | Поиск по id цен                                 | Высокая        | PRIMARY KEY (UNIQUE NOT NULL) |
| `product_id` | Запрос истории цен по продукту                  | Высокая        | INT, `NOT NULL`               |
| `price`      | Поиск по цене/диапазону цен                     | Высокая        | numeric,                      |
|              |                                                 |                | CHECK (price > 0)             |
| `start_date` | Поиск по дате начала (периоду) действия цены    | Высокая        | DATE, `NOT NULL`              |
| `end_date`   | Поиск по дате окончания (периоду) действия цены | Высокая        | DATE, `NOT NULL`              |

Индексы:
- CREATE INDEX idx_product_id_start_date_end_date ON prices(product_id,start_date,end_date)
- CREATE INDEX idx_price ON prices(price);
- CREATE INDEX idx_start_date ON prices(start_date);
- CREATE INDEX idx_end_date ON prices(end_date);

### 4. Анализ таблицы `Поставщики` (suppliers)
Возможные запросы/ограничения:

| Поле      | Описание запроса                    | Кардинальность | Ограничения                       |
|-----------|-------------------------------------|----------------|-----------------------------------|
| `id`      | Поиск по id поставщика              | Высокая        | PRIMARY KEY (UNIQUE NOT NULL)     |
| `name`    | Поиск поставщика по наименованию    | Высокая        | Максимум 255 символов, `NOT NULL` |
| `email`   | Поиск поставщика по адресу эл.почты | Высокая        | Максимум 32 символов, `UNIQUE`    |
| `address` | Поиск поставщика по адресу          | Высокая        | Максимум 255 символов             |
| `phone`   | Поиск поставщика по номеру телефона | Высокая        | Максимум 20 символов              |

Индексы:
- CREATE INDEX idx_name ON suppliers(name);
- CREATE INDEX idx_address ON suppliers(address);
- CREATE INDEX idx_phone ON suppliers(phone);

### 5. Анализ таблицы `Производители` (manufacturers)
Возможные запросы/ограничения:

| Поле      | Описание запроса                    | Кардинальность | Ограничения                       |
|-----------|-------------------------------------|----------------|-----------------------------------|
| `id`      | Поиск по id производителя           | Высокая        | PRIMARY KEY (UNIQUE NOT NULL)     |
| `name`    | Поиск поставщика по наименованию    | Высокая        | Максимум 255 символов, `NOT NULL` |
| `email`   | Поиск поставщика по адресу эл.почты | Высокая        | Максимум 32 символов, `UNIQUE`    |
| `address` | Поиск поставщика по адресу          | Высокая        | Максимум 255 символов             |
| `phone`   | Поиск поставщика по номеру телефона | Высокая        | Максимум 20 символов              |

Индексы:
- CREATE INDEX idx_name ON manufacturers(name);
- CREATE INDEX idx_address ON manufacturers(address);
- CREATE INDEX idx_phone ON manufacturers(phone);

### 6. Анализ таблицы `Покупатели` (customers)
Возможные запросы/ограничения:

| Поле      | Описание запроса                    | Кардинальность | Ограничения                        |
|-----------|-------------------------------------|----------------|------------------------------------|
| `id`      | Поиск по id покупателя              | Высокая        | PRIMARY KEY (UNIQUE NOT NULL)      |
| `name`    | Поиск поставщика по наименованию    | Высокая        | Максимум 255 символов, `NOT NULL`  |
| `email`   | Поиск поставщика по адресу эл.почты | Высокая        | Максимум 32 символов, `UNIQUE`     |
| `address` | Поиск поставщика по адресу          | Высокая        | Максимум 255 символов              |
| `phone`   | Поиск поставщика по номеру телефона | Высокая        | Максимум 20 символов               |

Индексы:
- CREATE INDEX idx_name ON customers(name);
- CREATE INDEX idx_address ON customers(address);
- CREATE INDEX idx_phone ON customers(phone);

### 7. Анализ таблицы `Покупки` (purchases)
Возможные запросы/ограничения:

| Поле            | Описание запроса                      | Кардинальность | Ограничения                   |
|-----------------|---------------------------------------|----------------|-------------------------------|
| `id`            | Поиск по id покупки                   | Высокая        | PRIMARY KEY (UNIQUE NOT NULL) |
| `customer_id`   | Поиск покупок по поставщику           | Высокая        | INT, `NOT NULL`               |
| `product_id`    | Поиск покупок по товару               | Высокая        | INT, `NOT NULL`               |
| `price_id`      | Поиск покупок по диапазону цен        | Высокая        | INT, `NOT NULL`               |
| `quantity`      | Поиск по количеству проданного товара | Высокая        | INT, `NOT NULL`               |
| `purchase_date` | Поиск по дате покупки                 | Высокая        | DATE, `NOT NULL`              |

Индексы:
- CREATE INDEX idx_customer_id_purchase_date ON purchases(customer_id,purchase_date,product_id);
- CREATE INDEX idx_product_id ON purchases(product_id);
- CREATE INDEX idx_price_id ON purchases(price_id);
- CREATE INDEX idx_purchase_date ON purchases(purchase_date);
